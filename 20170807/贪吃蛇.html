<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>贪吃蛇</title>
    <style>
    table{
        margin:100 auto;
        border-spacing:1px;  
        /* border-collapse: collapse; */
    }
    tr{
        margin: 0;
        background-color: lightblue;
    }
    td{
        /* background-color: #000; */
        width: 20px;
        height: 20px;
        margin: 0;
    }
    .red{
        background-color: red;
    }

    </style>
</head>
<body>
    <table id="oTable">

    </table>
    
    <script>

    var oTable = document.getElementById("oTable");
    var tds = [];

        for (var i = 0; i<20 ;i++){
            var tr = document.createElement("tr");
            var thisRow = [];//存放当前行的td

            for (var j = 0 ;j < 20 ;j++){
                var td = document.createElement("td");
                tr.appendChild(td);
                thisRow.push(td);
            }
            oTable.appendChild(tr);
            tds.push(thisRow);
        }


        function Snake(){
            this.body = [
                {x : 3,y : 4},
                {x : 4,y : 4},
                {x : 5,y : 4},]
            this.food = [];
            this.diraction = null;

            this.render();
            this.move();
        }

            // 渲染
        Snake.prototype.render = function(){
            for(var i =0 ;i<20 ;i++){
                for (var j=0 ;j<20 ;j++){
                    tds[i][j].className = "";
                }
            }
            for(var i =0 ;i<this.body.length ;i++){
                tds[this.body[i].y][this.body[i].x].className = "red";
            }
        }

        Snake.prototype.move = function(){

             var self = this;

            document.onkeydown = function(event){
                event = event || window.event;
                var keyCode = event.keyCode;


                self.x= self.body[0].x;
                self.y= self.body[0].y;
                
 
                clearInterval(self.timer);
                
                switch(keyCode){
                    case 37:
                        if(self.diraction == 37){
                            break;
                        }else{
                            self.body.pop();   
                            self.x --;
                            self.diraction = 37;
                        }
                    break;
                    case 38:
                        if(self.diraction == 38){
                            break;
                        }else{
                            self.body.pop();                               
                            self.y --;
                            self.diraction = 38;
                        }
                    break;
                    case 39:
                        if(self.diraction == 39){
                            break;
                        }else{
                            self.body.pop();                               
                            self.x ++;                            
                            self.diraction = 39;
                        }
                    break;
                    case 40:
                       if(self.diraction == 40){
                            break;
                        }else{
                            self.body.pop();                               
                            self.y ++;
                            self.diraction = 40;
                        }
                    break; 
                }
                    self.body.unshift( {x : self.x, y : self.y} );
                    self.render();
                    self.auto();
            }

        }

        Snake.prototype.grown = function(){

            this.food = [{x:parseInt(Math.random()*20) , y:parseInt(Math.random()*20) } ]

            tds[this.food[0].y][this.food[0].x].className = "red";

            if(this.body[0].x == this.food[0].x && this.food[0].y == his.body[0].y)

            this.body.unshift(this.food[0]);

        }

        Snake.prototype.auto = function(){
                var self = this;
            this.timer = setInterval(function(){
                self.body.pop();


            if (this.food == [])                
                this.grown();
                    

                switch(self.diraction){
                    case 37:
                        if(self.diraction == 37){
                            self.x --;
                        }
                    break;
                    case 38:
                        if(self.diraction == 38){
                            self.y --;
                        }
                    break;
                    case 39:
                        if(self.diraction == 39){
                            self.x ++;                            
                        }
                    break;
                    case 40:
                        if(self.diraction == 40){
                            self.y ++;
                        }
                    break;
                }
                self.body.unshift( {x : self.x, y : self.y} );
                if(self.x<0 || self.x>19 || self.y<0 || self.y>19){
                    clearInterval(self.timer);
                    alert("游戏结束，你的得分为"+self.body.length);
                    return;
                }
                self.render();
            },200)
        }
        


        var snake = new Snake(); 
    </script>
</body>
</html>